ymin = L@extent@ymin
res = L_RES
if(band == "P")
res = H_RES
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
for(col in 1:ncols){
for(row in 1:nrows){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + PATCH_SIZE * res, ymin, ymin + PATCH_SIZE * res)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
break
}
ymin = ymin + PATCH_SIZE * res
}
if(L_crop@data@min > 0){
break
}
xmin = L@extent@xmin
xmin = xmin + PATCH_SIZE * res
}
patch
L_crop
L
L@extent@ymax - L@extent@ymax
L@extent@ymax - L@extent@ymin
L@extent@xmax - L@extent@xmin
L@ncols
L@nrows
ncols
nrows
band = "B"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
res = L_RES
if(band == "P")
res = H_RES
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
for(col in 1:ncols){
ymin = L@extent@ymin
for(row in 1:nrows){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + PATCH_SIZE * res, ymin, ymin + PATCH_SIZE * res)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
break
}
ymin = ymin + PATCH_SIZE * res
}
if(L_crop@data@min > 0){
break
}
xmin = xmin + PATCH_SIZE * res
}
L_crop
band = "B"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
res = L_RES
if(band == "P")
res = H_RES
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
for(col in 1:ncols){
ymin = L@extent@ymin
for(row in 1:nrows){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + PATCH_SIZE * res, ymin, ymin + PATCH_SIZE * res)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
break
}
ymin = ymin + PATCH_SIZE * res
}
if(L_crop@data@min > 0){
break
}
xmin = xmin + PATCH_SIZE * res
}
band = "B"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
res = L_RES
if(band == "P")
res = H_RES
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
for(col in 1:ncols){
ymin = L@extent@ymin
for(row in 1:nrows){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + PATCH_SIZE * res, ymin, ymin + PATCH_SIZE * res)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
break
}
ymin = ymin + PATCH_SIZE * res
}
if(L_crop@data@min > 0){
break
}
xmin = xmin + PATCH_SIZE * res
}
band = "B"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
res = L_RES
if(band == "P")
res = H_RES
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
for(col in 1:ncols){
ymin = L@extent@ymin
for(row in 1:nrows){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + PATCH_SIZE * res, ymin, ymin + PATCH_SIZE * res)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
#break
}
ymin = ymin + PATCH_SIZE * res
}
xmin = xmin + PATCH_SIZE * res
}
800 / 15
band = "P"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
res = L_RES
if(band == "P")
res = H_RES
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
for(col in 1:ncols){
ymin = L@extent@ymin
for(row in 1:nrows){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + PATCH_SIZE * res, ymin, ymin + PATCH_SIZE * res)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
#break
}
ymin = ymin + PATCH_SIZE * res
}
xmin = xmin + PATCH_SIZE * res
}
band = "P"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + size, ymin, ymin + size)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
ymin = ymin + size
}
ymin = ymin + 1
}
xmin = xmin + size
}
band = "P"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
print(paste("Row:",row,"Col:",col))
patch <- extent(xmin, xmin + size, ymin, ymin + size)
#crs(patch) <- crs(L)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
ymin = ymin + size
}
ymin = ymin + 1
}
xmin = xmin + size
}
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
ymin = ymin + size
}
ymin = ymin + 1
}
xmin = xmin + size
}
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
ymin = ymin + size
}
ymin = ymin + res
}
xmin = xmin + size
}
band = "P"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
ymin = ymin + size
}
ymin = ymin + res
}
xmin = xmin + size
}
band = "P"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(max(v) > 0){
plot(L_crop)
}
ymin = ymin + size
}
xmin = xmin + size
}
v
plot(L_crop)
plot(v)
min(v)
band = "P"
L = L7[band][[1]]
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
}
ymin = ymin + size
}
xmin = xmin + size
}
inMemory(L)
fromDisk(L)
LL = readAll(L)
inMemory(LL)
band = "P"
L = readAll(L7[band][[1]])
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
}
ymin = ymin + size
}
xmin = xmin + size
}
library(satellite)
library(raster)
library(rgdal)
library(tidyverse)
SAVE_FLAG = F
PLOT_FLAG = T
PATCH_SIZE = 32
H_RES = 15
L_RES = 30
sysinf <- Sys.info()
landsat_dir = "H:/L7/"
if(sysinf['sysname'] == "Linux")
landsat_dir = "/opt/GISData/L7/"
B = vector("list", 5)
metadata = readLines(paste0(landsat_dir, "L7_MTL.txt"))
R_MB = as.numeric(str_split_fixed(metadata[grep("REFLECTANCE_MULT_BAND", str_trim(metadata))], " = ", 2)[,2])
R_AD = as.numeric(str_split_fixed(metadata[grep("REFLECTANCE_ADD_BAND", str_trim(metadata))], " = ", 2)[,2])
Bands = c("B", "G", "R", "I", "S1", "T", "S2", "P")
L7 = vector("list")
for(i in c(1,2,3,4,8)){
L7[[Bands[i]]] = raster(paste0(landsat_dir,"L7_",i,".tif"))
}
band = "P"
L = readAll(L7[band][[1]])
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
}
ymin = ymin + size
}
xmin = xmin + size
}
source('/opt/ICT2018/R/Landsat7PatchExtractor.R')
library(satellite)
library(raster)
library(rgdal)
library(tidyverse)
SAVE_FLAG = F
PLOT_FLAG = F
PATCH_SIZE = 24
H_RES = 15
L_RES = 30
sysinf <- Sys.info()
landsat_dir = "H:/L7/"
if(sysinf['sysname'] == "Linux")
landsat_dir = "/opt/GISData/L7/"
B = vector("list", 5)
metadata = readLines(paste0(landsat_dir, "L7_MTL.txt"))
R_MB = as.numeric(str_split_fixed(metadata[grep("REFLECTANCE_MULT_BAND", str_trim(metadata))], " = ", 2)[,2])
R_AD = as.numeric(str_split_fixed(metadata[grep("REFLECTANCE_ADD_BAND", str_trim(metadata))], " = ", 2)[,2])
Bands = c("B", "G", "R", "I", "S1", "T", "S2", "P")
L7 = vector("list")
for(i in c(1,2,3,4,8)){
L7[[Bands[i]]] = raster(paste0(landsat_dir,"L7_",i,".tif"))
}
band = "P"
L = readAll(L7[band][[1]])
xmin = L@extent@xmin
ymin = L@extent@ymin
xmax = L@extent@xmax
ymax = L@extent@ymax
res = L_RES
if(band == "P")
res = H_RES
size = PATCH_SIZE * res
ncols = (L@ncols - (L@ncols %% PATCH_SIZE)) / PATCH_SIZE
nrows = (L@nrows - (L@nrows %% PATCH_SIZE)) / PATCH_SIZE
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
}
ymin = ymin + size
}
xmin = xmin + size
}
L_crop
plot(L_crop)
v
matrix(v)
matrix(v, ncols=PATCH_SIZE)
as.matrix(v, ncols=PATCH_SIZE)
?as.matrix
as.matrix(L_crop)
plot(as.matrix(L_crop))
plot(1:10)
dev.off()
while(xmin < xmax - size){
ymin = L@extent@ymin
while(ymin < ymax - size){
patch <- extent(xmin, xmin + size, ymin, ymin + size)
L_crop = crop(L, patch)
print(paste(L_crop@extent@xmin," ",L_crop@extent@xmax," ",L_crop@extent@ymin," ",L_crop@extent@ymax))
v = getValues(L_crop)
if(min(v) > 0){
plot(L_crop)
}
ymin = ymin + size
}
xmin = xmin + size
}
